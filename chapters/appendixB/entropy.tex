\providecommand{\toplevelprefix}{../..}  % necessary for subfile bibliography + figures compilation to work, do not move this after documentclass
\documentclass[../../book-main.tex]{subfiles}

\begin{document}

\chapter{Entropy, Diffusion, and Denoising}\label{app:entropy}\label{app:diffusion-denoising}

\begin{quote}
``{\em The increase of disorder or entropy with time is one example of what is called an arrow of time, something that distinguishes the past from the future, giving a direction to time.}''

$~$\hfill -- A Brief History of Time, Stephen Hawking
 \end{quote}
\vspace{5mm}

In this appendix we provide proofs for several facts, mentioned in \Cref{ch:general-distribution}, which are related to differential entropy and how it evolves under diffusion processes. We will make the following mild assumption about the random variable representing the data source, which we call \(\vx\).

\begin{assumption}\label{assumption:entropy_x_compact_support}
    \(\vx\) is supported on a compact set \(\cS \subseteq \R^{D}\) of radius at most \(R\), i.e., \(R := \sup_{\vxi \in \cS}\norm{\vxi}_{2}\).
\end{assumption}

In particular, since compact sets in Euclidean space are bounded, it holds \(R < \infty\). We will consistently use the notation \(B_{r}(\vxi) := \{\vu \in \R^{D} \colon \norm{\vxi - \vu}_{2} \leq r\}\) to denote the Euclidean ball of radius \(r\) centered at \(\vxi\). In this sense, \Cref{assumption:entropy_x_compact_support} has \(\cS \subseteq B_{R}(\vzero)\).

Notice that this assumption holds for (almost) all variables we care about in practice, as it is (often) imposed by a normalization step during data pre-processing. 

\section{Differential Entropy of Low-Dimensional Distributions}\label{sec:low_dim_entropy}

In this short appendix we provide a proof of the following fact.

\begin{theorem}\label{thm:degenerate_entropy_negative_infinity}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support} holds, and the support \(\cS\) of \(\vx\) has \(0\) volume.\footnote{Formally this means that \(\cS\) is Borel measurable with Borel measure \(0\).} Then \(h(\vx) = -\infty\).
\end{theorem}
\begin{proof}
    We will show this for the case that \(\vx\) is uniform on \(\cS\); this setting captures the essential ideas without being too technical. The basic idea is to take an \(\eps\)-thickening of \(\cS\), say \(\cS_{\eps}\) defined as 
    \begin{equation}
        S_{\eps} = \bigcup_{\vxi \in \cS}B_{\eps}(\vxi)
    \end{equation}
    and visualized in \Cref{fig:entropy_eps_thickening}.
    \begin{figure}[th]
        \centering
        \begin{tikzpicture}
            \def\radius{0.2cm} % Define epsilon value
            \def\curve{(0,0) .. controls (1,1.5) and (3,-0.5) .. (4,1)} % Define the curve S

            % Draw many overlapping circles along the curve to represent the thickening S_eps
            % Use a decoration to place marks (circles) along the path
            \path[decoration={markings, mark=between positions 0 and 1 step 0.02 with {
                    % Fill a circle at each mark; low opacity to show overlap
                    \fill[red!30, opacity=0.5, draw=none] (0,0) circle (\radius);
                }}, postaction={decorate}] \curve;

            % Draw the original curve S on top, thicker and in blue
            \draw[blue, thick] \curve node[right, blue] {$\cS$};

            % Choose an example point x on the curve S
            \coordinate (p_on_curve) at (2, 0.5); % Approximate point on the curve
            % Draw the specific ball B_eps(x) for this x, slightly darker/more opaque
            \fill[red!50, opacity=0.7] (p_on_curve) circle (\radius);
            % Mark the point x
            \fill[black] (p_on_curve) circle (1pt) node[below left] {$x$};
            % Add an arrow indicating the radius epsilon for this specific ball

            % Label the thickened region S_eps, placing the label appropriately
             \node[red, below right] at (3.5, -0.2) {$\cS_{\eps} = \bigcup_{\vxi \in S} B_{\eps}(\vxi)$};

        \end{tikzpicture}
        \caption{Illustration of the \(\eps\)-thickening \(\cS_\eps\) of a curve \(\cS \subseteq \R^{2}\).}
        \label{fig:entropy_eps_thickening}
    \end{figure}
    We will work with random variables whose support is \(\cS_{\eps}\), which is fully-dimensional, and take the limit as \(\eps \to 0\).

    Thus let \(\vx \sim \dUnif(\cS)\) such that it does not have a density\footnote{w.r.t.~the Borel measure on \(\R^{D}\).} and \(\vx_{\eps} \sim \dUnif(\cS_{\eps})\). Since \(\cS_{\eps}\) has positive volume, \(\vx_{\eps}\) has a density \(p_{\eps}\) equal to
    \begin{equation}
        p_{\eps}(\vxi) = \indvar(\vxi \in \cS_{\eps}) \cdot \frac{1}{\volume(\cS_{\eps})}.
    \end{equation}
    Since \(\vx\) does not have a density, the way to make sense of \(h(\vx)\) is through the equality 
    \begin{equation}
        h(\vx) = \lim_{\eps \searrow 0}h(\vx_{\eps});
    \end{equation}
    we will show that the latter limit evaluates to \(-\infty\).

    Indeed, using the convention that \(0 \log 0 = 0\), it holds
    \begin{align}
        h(\vx_{\eps}) 
        &= -\int_{\R^{D}}p_{\eps}(x)\log p_{\eps}(x)\odif{x} \\ 
        &= -\int_{\cS_{\eps}}\frac{1}{\volume(\cS_{\eps})} \log\rp{\frac{1}{\volume(\cS_{\eps})}}\odif{\vxi} \\ 
        &= \frac{\log(\volume(\cS_{\eps}))}{\volume(\cS_{\eps})}\int_{\cS_{\eps}}\odif{\vxi} \\ 
        &= \log(\volume(\cS_{\eps})).
    \end{align}
    Since \(\cS\) is compact \(\volume(\cS_{\eps})\) is finite and tends to \(0\) as \(\eps \searrow 0\).\footnote{In the case where \(\cS\) is not compact and \(\vx\) is not uniform on \(\cS\), we define a more refined version of \(\vx_{\eps}\) whose density at \(\vxi\) changes at different rates in the directions orthogonal to and aligned with \(\cS\) at \(\vxi\). This density results in a different calculation which does not involve the volume of \(\cS_{\eps}\) but rather something like the effective volume taken up by \(\vx_{\eps}\), which is finite and vanishing as \(\eps \searrow 0\).} Thus
    \begin{equation}
        h(\vx) = \lim_{\eps \searrow 0}h(\vx_{\eps}) = \lim_{\eps \searrow 0}\log(\volume(\cS_{\eps})) = -\infty,
    \end{equation}
    as desired.
\end{proof}

The above theorem is actually a corollary of a much more famous and celebrated set of results about the maximum possible entropy of \(\vx\) subject to certain constraints on the distribution of \(\vx\). We would be remiss to not provide the results here, but we do not give the proofs; a suitable reference would be \cite{poliyanski2024information}.
\begin{theorem}\label{thmx:max_entropy}
    Let \(\vx\) be a random variable on \(\R^{D}\).
    \begin{enumerate}
        \item If \(\vx\) is supported on a compact set \(\cS \subseteq \R^{D}\) (i.e., \Cref{assumption:entropy_x_compact_support}) then
        \begin{equation}
            h(\vx) \leq h(\dUnif(\cS)) = \log \volume(\cS).
        \end{equation}
        \item If \(\vx\) has finite covariance such that, for a PSD matrix \(\vSigma \in \PSD(D)\), it holds \(\Cov(\vx) \preceq \vSigma\) (w.r.t.~the PSD ordering, i.e., \(\vSigma - \Cov(\vx)\) is PSD), then
        \begin{equation}
            h(\vx) \leq h(\dNorm(\vzero, \vSigma)) = \frac{1}{2}\log((2\pi e)^{D}\det\vSigma).
        \end{equation}
        \item If \(\vx\) has finite second moment such that, for a constant \(a \geq 0\), it holds \(\Ex\norm{\vx}_{2}^{2} \leq a\), then
        \begin{equation}
            h(\vx) \leq h\rp{\dNorm\rp{\vzero, \frac{a}{D}\vI}} = \frac{D}{2}\log\frac{2\pi e a}{D}.
        \end{equation}
    \end{enumerate}
\end{theorem}
Clearly \Cref{thm:degenerate_entropy_negative_infinity} is a special case of \Cref{thmx:max_entropy}.1 with \(\volume(\cS) = 0\).



\section{Diffusion and Denoising Processes}\label{sec:entropy_diffusion}

In the main body (\Cref{ch:general-distribution}), we considered a random variable \(\vx\), and a stochastic process defined by \eqref{eq:additive_gaussian_noise_model}, i.e.,
\begin{equation}\label{eq:app_additive_gaussian_noise_model}
    \vx_{t} = \vx + t\vg, \qquad  \forall t \in [0, T]
\end{equation}
where \(\vg \sim \dNorm(\vzero, \vI)\) independently of \(\vx\). 

The structure of this section is as follows. In \Cref{sub:diffusion_entropy_increases} we provide a formal theorem and crisp proof which shows that under \Cref{eq:app_additive_gaussian_noise_model} the entropy increases, i.e., \(\odv*{h(\vx_{t})}{t} > 0\). In \Cref{sub:denoising_entropy_decreases} we provide a formal theorem and crisp proof which shows that under \Cref{eq:app_additive_gaussian_noise_model}, the entropy decreases during denoising, i.e., \(h(\Ex[\vx_{s} \given \vx_{t}]) < h(\vx_{t})\) for all \(s < t\). In \Cref{sub:app_diffusion_intermediate_results} we provide proofs for technical lemmas that are needed to establish the claims in the previous subsections.

Before we start, we introduce some key notations. First, let \(\phi_{t}\) be the density of \(\dNorm(\vzero, t^{2}\vI)\), i.e.,
\begin{equation}\label{eq:gaussian_noise_time_t}
    \phi_{t}(\vxi) := \frac{1}{(2\pi)^{D/2}t^{D}}\exp\rp{-\frac{\norm{\vxi}_{2}^{2}}{t^{2}}}.
\end{equation}
Next, \(\vx_{t}\) is supported on all of \(\R^{D}\), so it has a \textit{density}, which we denote \(p_{t}\) (as in the main body). A quick calculation shows that
\begin{equation}\label{eq:p_t_representation}
    p_{t}(\vxi) = \Ex[\phi_{t}(\vxi - \vx)],
\end{equation}
and from this representation it is possible to deduce (i.e., from \Cref{prop:diff_convolution}) that \(p_{t}\) is smooth (i.e., infinitely differentiable) in \(\vxi\), also smooth in \(t\), and positive everywhere. This fact is somewhat remarkable at first sight: even for a completely irregular random variable \(\vx\) (say, a Bernoulli random variable, which does not have a density), its Gaussian smoothing admits a density for every (arbitrarily small) \(t > 0\). The proof is left as an exercise for readers well-versed in mathematical analysis.

However, we also need to add an assumption about the \textit{smoothness} of the distribution of \(\vx\), which will eliminate some technical problems that occur around \(t = 0\) with low-dimensional distributions.\footnote{As then various quantities become highly irregular and dealing with them would require significant additional analysis.} Despite this, we expect that our results hold under milder assumptions with additional work. For now, let us assume:
\begin{assumption}\label{assumption:entropy_x_density}
    \(\vx\) has a twice continuously differentiable density, denoted \(p\).
\end{assumption}


\subsection{Diffusion Process Increases Entropy Over Time}\label{sub:diffusion_entropy_increases}

In this section appendix we provide a proof of \Cref{thm:diffusion_entropy_increases}. For convenience, we restate it as follows. 

\begin{theorem}[Diffusion Increases Entropy]\label{thm:diffusion_entropy_increases}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. Then 
    \begin{equation}\label{eq:diffusion_entropy_increases}
        h(\vx_{s}) < h(\vx_{t}), \qquad \forall s, t \colon 0 \leq s < t \leq T.
    \end{equation}
\end{theorem}
\begin{proof}
    Before we start, let us address a pedantic question: when does the inequality in \eqref{eq:diffusion_entropy_increases} make sense? We will show in \Cref{lem:diffusion_entropy_exists} that under our assumptions, the differential entropy is well-defined, is never \(+\infty\), and for \(t > 0\) is finite, so the (strict) inequality in \eqref{eq:diffusion_entropy_increases} makes sense.

    Pedantry aside, the crux of this proof is to show that the density \(p_{t}\) of \(\vx_{t}\) satisfies a particular partial differential equation, which is very similar to the \textit{heat equation}. The heat equation is a famous PDE which describes the diffusion of heat through space. This intuitively should make sense, and paints a mental picture: as the time \(t\) increases, the probability from the original (perhaps tightly concentrated) \(\vx\) disperses across all of \(\R^{D}\) like heat radiating from a source in a vacuum.
    
    Such PDEs for \(p_{t}\), known as \textit{Fokker-Planck equations} for more general stochastic processes, are very powerful tools, as they allow us to describe the instantaneous temporal derivatives of \(p_{t}\) in terms of the instantaneous spatial derivatives of \(p_{t}\), and vice versa, providing a concise description of the regularity and dynamics of \(p_{t}\). Once we obtain dynamics for \(p_{t}\), we can then use the system to obtain another one which describes the dynamics of \(h(\vx_{t})\), which after all is just a functional of \(p_{t}\).  

    The description of the PDE involves a mathematical object called the Laplacian \(\Delta\). Recall from your multivariable calculus class that the Laplacian operating on a differentiable-in-time and twice-differentiable-in-space function \(f \colon (0, T) \times \R^{D} \to \R\) is given by
    \begin{equation}
        \Delta f_{t}(\vxi) = \tr(\nabla^{2}f_{t}(\vxi)) = \sum_{i = 1}^{D}\pdv[order=2]{f_{t}}{\xi_{i}}(\vxi).
    \end{equation}
    
    Namely, from using the integral representation of \(p_{t}\) and differentiating under the integral, we can compute the derivatives of \(p_{t}\) (which we do in \Cref{prop:p_t_derivatives}) and observe that \(p_{t}\) satisfies the heat-like PDE
    \begin{equation}
        \pdv{p_{t}}{t}(\vxi) = t\Delta p_{t}(\vxi).
    \end{equation}
    Then for finding the dynamics of \(h(\vx_{t})\), we can use \Cref{prop:dutis} again as well as the heat-like PDE to get
    \begin{align}
        \odv*{h(\vx_{t})}{t}
        &= -\odv*{\int_{\R^{D}}p_{t}(\vxi)\log p_{t}(\vxi)\odif{\vxi}}{t} \\
        &= -\int_{\R^{D}}\pdv*{\bs{p_{t}(\vxi)\log p_{t}(\vxi)}}{t}\odif{\vxi} \\
        &= -\int_{\R^{D}}\pdv{p_{t}}{t}(\vxi)[1 + \log p_{t}(\vxi)]\odif{\vxi} \\
        &= -t\int_{\R^{D}}\Delta p_{t}(\vxi)[1 + \log p_{t}(\vxi)]\odif{\vxi}.
    \end{align}
    By using a slightly involved integration by parts argument (\Cref{lem:diffusion_ibp}), we obtain 
    \begin{align}
        \odv*{h(\vx_{t})}{t}
        &= t\int_{\R^{D}}\ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}\odif{\vxi} \\
        &= t\int_{\R^{D}}\frac{\norm{\nabla p_{t}(\vxi)}_{2}^{2}}{p_{t}(\vxi)}\odif{\vxi} \\
        &> 0
    \end{align}
    where strict inequality holds in the last line because, for it to not hold, \(\nabla p_{t}(\vxi)\) would need to vanish almost everywhere (i.e., everywhere except possibly on a set of zero volume), but this would imply that \(p_{t}\) would be constant almost everywhere, a contradiction with a fact that \(p_{t}\) is a density.

    To complete the proof we just use the fundamental theorem of calculus
    \begin{equation}
        h(\vx_{t}) = h(\vx_{s}) + \int_{s}^{t}\odv*{h(\vx_{u})}{u}\odif{u} > h(\vx_{s}),
    \end{equation}
    which proves the claim. (Note that this does not make sense when \(h(\vx_{s}) = -\infty\), which can only happen when \(s = 0\) and \(h(\vx) = -\infty\), but in this case \(h(\vx_{t}) > -\infty\) so the claim is vacuously true anyways.)
\end{proof}

\subsection{Denoising Process Reduces Entropy Over Time}\label{sub:denoising_entropy_decreases}

Recall that in \Cref{sub:intro_diffusion_denoising} we start with the random variable \(\vx_{T}\) and iteratively denoise it using iterations of the form
\begin{equation}\label{eq:app_denoising_iteration}
    \hat{\vx}_{s} := \Ex[\vx_{s} \mid \vx_{t} = \hat{\vx}_{t}] = \frac{s}{t}\hat{\vx}_{t} + \bp{1 - \frac{s}{t}}\bar{\vx}^{\ast}(t, \hat{\vx}_{t}).
\end{equation}
for \(s, t \in \{t_{0}, t_{1}, \dots, t_{L}\}\) with \(s < t\) and \(\vx_{T} = \hat{\vx}_{T}\). We wish to prove that \(h(\hat{\vx}_{s}) < h(\hat{\vx}_{t})\), showing that the denoising process actually reduces the entropy.

Before we go about doing this, we make several remarks about the problem statement. First, Tweedie's formula \eqref{eq:tweedie} says that 
\begin{equation}
    \bar{\vx}^{\ast}(t, \vx_{t}) = \vx_{t} + t^{2}\nabla p_{t}(\vx_{t}),
\end{equation}
which likens a full denoising step from time \(t\) to time \(0\) to a gradient step on the log-density of \(\vx_{t}\). Can we get a similar result for the full denoising step from time \(t\) to time \(s\) in \eqref{eq:app_denoising_iteration}? It turns out that indeed we can, and it is pretty simple. By using \eqref{eq:app_denoising_iteration} and Tweedie's formula \eqref{eq:tweedie}, we obtain
\begin{equation}\label{eq:app_denoising_iteration_score}
    \Ex[\vx_{s} \mid \vx_{t}] = \frac{s}{t}\vx_{t} + \bp{1 - \frac{s}{t}}\bp{\vx_{t} + t^{2}\nabla_{\vx_{t}}\log p_{t}(\vx_{t})} = \vx_{t} + \bp{1 - \frac{s}{t}}t^{2}\nabla_{\vx_{t}}\log p_{t}(\vx_{t}).
\end{equation}
So this iterative denoising step is again a gradient step on the perturbed log-density \(\log p_{t}\) with a shrunken step size. In particular, this step can be seen as a perturbation of the distribution of the random variable \(\vx_{t}\) by the \textit{score function vector field}, suggesting a connection to stochastic differential equations (SDEs) and the theory of diffusion models \cite{song2020score}. Indeed, a proof of the following result \Cref{thm:conditioning_reduces_entropy} can be developed using this powerful machinery and a limiting argument (e.g., following the technical approach in the exposition of \cite{DBLP:conf/iclr/ChenC0LSZ23}). We will give a simpler proof here, which will use only elementary tools and  thereby illuminate some of the key quantities behind the process of entropy reduction via denoising. On the other hand, we will need to deal with some slightly technical calculations due to the fact that the denoising process in \Cref{thm:conditioning_reduces_entropy} does \textit{not} correspond exactly to the \textit{reverse} process associated to the noise addition process that generates the observation \(\vx_{t}\).\footnote{For those familiar with diffusion models, we refer here to the time-reversed forward process not coinciding with the sequence of iterates generated by the process defined by \Cref{thm:conditioning_reduces_entropy}. These processes coincide in a certain limit where infinitely many steps of \Cref{thm:conditioning_reduces_entropy} are taken with infinitely small levels of noise added at each step; for general, finite steps, we must introduce some approximations regardless of the level of sophistication of our tools.}

We want to prove that \(h(\Ex[\vx_{s} \mid \vx_{t}]) < h(\vx_{t})\), i.e., formally:
\begin{theorem}\label{thm:conditioning_reduces_entropy}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. Then 
    \begin{equation}
        h(\Ex[\vx_{s} \mid \vx_{t}]) < h(\vx_{t}), \qquad \forall s, t \in [0, T] \colon \quad 0 < t \leq \frac{R}{\sqrt{2D}}, \quad 0 \leq s  < t\cdot\min\bc{1, \frac{R^{2}/D - 2t^{2}}{R^{2}/D - t^{2}}}.
    \end{equation}
\end{theorem}
\begin{proof}
    This proof uses two main ideas:
    \begin{enumerate}
        \item First, write down a density for \(\Ex[\vx_{s} \mid \vx_{t}]\) using a change-of-variables formula.
        \item Second, bound this density to control the entropy.
    \end{enumerate}
    The change of variables is justified by \Cref{cor:gribonval_A2}, which was originally derived in \cite{Gribonval2011-pf}.

    We execute these ideas now. From \Cref{cor:gribonval_A2}, we obtain that the function \(\bar{\vx}\) defined as \(\bar{\vx}(\vxi) := \Ex[\vx_{s} \given \vx_{t} = \vxi]\) is differentiable, injective, and thus invertible on its range, which we henceforth denote \(\cX \subseteq \R^{D}\). We denote its inverse as \(\bar{\vx}^{-1}\). Using a change-of-variables formula, the density \(\bar{p}\) of \(\bar{\vx}(\vx_{t})\) is given by 
    \begin{equation}
        \bar{p}(\vxi) := \frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))},
    \end{equation}
    where (recall, from \Cref{app:optimization}) \(\bar{\vx}^{\prime}\) is the Jacobian of \(\bar{\vx}\). Since from \Cref{lem:gribonval_A1} we know \(\bar{\vx}^{\prime}\) is a positive definite matrix, the determinant is positive and so the whole density is positive. Then it follows that 
    \begin{align}
        h(\bar{\vx}(\vx_{t}))
        &= -\int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))} \log \frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))} \odif{\vxi} \\ 
        &= -\int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))} \log((p_{t} \circ \bar{\vx}^{-1})(\vxi))\odif{\vxi} \\ 
        &\qquad + \int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}\logdet\rp{\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi))}\odif{\vxi} \\ 
        &= -\int_{\R^{D}}p_{t}(\vxi)\log p_{t}(\vxi)\odif{\vxi} + \int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}\logdet\rp{\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi))}\odif{\vxi} \\ 
        &= h(\vx_{t}) - \int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}\log\rp{\frac{1}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}}\odif{\vxi}.
    \end{align}
    We will study the last term (including the \(-\)), and show that it is negative.

    By concavity, one has \(-x\log x \leq 1 - x\) for every \(x \geq 0\). Hence 
    \begin{align}
        h(\bar{\vx}(\vx_{t})) - h(\vx_{t})
        &= - \int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}\log\rp{\frac{1}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}}\odif{\vxi} \\ 
        &\leq  \int_{\cX}(p_{t} \circ \bar{\vx}^{-1})(\vxi)\cdot \bp{1 - \frac{1}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}}\odif{\vxi} \\ 
        &= \int_{\cX}(p_{t} \circ \bar{\vx}^{-1})(\vxi)\odif{\vxi} - \int_{\cX}\frac{(p_{t} \circ \bar{\vx}^{-1})(\vxi)}{\det(\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi)))}\odif{\vxi} \\
        &= \int_{\R^{D}}p_{t}(\vxi)\det\rp{\bar{\vx}^{\prime}(\bar{\vx}^{-1}(\vxi))}\odif{\vxi} - \int_{\cX}\bar{p}(\vxi)\odif{\vxi} \\
        &= \int_{\R^{D}}p_{t}(\vxi)\det\rp{\vI + \bp{1 - \frac{s}{t}}t^{2}\nabla^{2}\log p_{t}(\vxi)}\odif{\vxi} - 1.
    \end{align}
    Now, by the AM-GM inequality on eigenvalues, we have for any symmetric positive definite matrix \(\vM \in \PSD(D)\) the bound 
    \begin{equation}
        \det(\vM)^{1/D} = \prod_{i = 1}^{D}\lambda_{i}(\vM)^{1/D} \leq \frac{\sum_{i = 1}^{D}\lambda_{i}(\vM)}{D} = \frac{\tr(\vM)}{D},
    \end{equation}
    which we can apply to the above expression and obtain 
    \begin{align}
        &\int_{\R^{D}}p_{t}(\vxi)\det\rp{\vI + \bp{1 - \frac{s}{t}}t^{2}\nabla^{2}\log p_{t}(\vxi)}\odif{\vxi} \\
        &\leq \int_{\R^{D}} p_{t}(\vxi) \tr\rp{\frac{1}{D}\bs{\vI + \bp{1 - \frac{s}{t}}t^{2}\nabla^{2}\log p_{t}(\vxi)}}^{D}\odif{\vxi} \\
        &= \int_{\R^{D}} p_{t}(\vxi)\bp{1 + \frac{\bp{1 - \frac{s}{t}}t^{2}}{D}\tr(\nabla^{2}\log p_{t}(\vxi))}^{D}\odif{\vxi} \\
        &= \int_{\R^{D}} p_{t}(\vxi)\bp{1 + \frac{\bp{1 - \frac{s}{t}}t^{2}}{D}\Delta \log p_{t}(\vxi)}^{D}\odif{\vxi}.
    \end{align}
    From \Cref{lem:app_diffusion_laplacian_control}, it holds (where, recall, \(R\) is the radius of the support of \(\vx\) as in \Cref{assumption:entropy_x_compact_support})
    \begin{equation}
        \abs{\Delta \log p_{t}(\vxi)} \leq \max\rp{\frac{D}{t^{2}}, \abs*{\frac{R^{2}}{t^{4}} - \frac{D}{t^{2}}}} =: U_{t}.
    \end{equation}
    Then it holds
    \begin{equation}
        -\frac{\bp{1 - \frac{s}{t}}t^{2}}{D}U_{t} \leq \frac{\bp{1 - \frac{s}{t}}t^{2}}{D}\Delta \log p_{t}(\vxi) \leq \frac{\bp{1 - \frac{s}{t}}t^{2}}{D}U_{t}.
    \end{equation}
    Meanwhile, the function \(x \mapsto (1 + x)^{D}\) is convex on \([-1, \infty)\), so for
    \(-(1-s/t)t^{2}U_{t}/D \leq x \leq (1-s/t)t^{2}U_{t}/D\) we have 
    \begin{align}
        (1 + x)^{d} 
        &\leq \bp{1 - \frac{\bp{1 - \frac{s}{t}}t^{2}U_{t}}{D}}^{D} + \underbrace{\bs{\bp{1 + \frac{\bp{1 - \frac{s}{t}}t^{2}U_{t}}{D}}^{D} - \bp{1 - \frac{\bp{1 - \frac{s}{t}}t^{2}U_{t}}{D}}^{D}}}_{M(s, t, D)}x \\ 
        &\leq 1 + M(s, t, D)x.
    \end{align}
    Here \(M(s, t, D) > 0\) since \(U_{t} > 0\). In the above bound, we need to verify that the lower bound for \(x\) is \(\geq -1\). Indeed,
    \begin{align}
        -\frac{\bp{1 - \frac{s}{t}}t^{2}}{D}U_{t}
        &= -\frac{\bp{1 - \frac{s}{t}}t^{2}}{D}\max\rp{\frac{D}{t^{2}}, \abs*{\frac{R^{2}}{t^{4}} - \frac{D}{t^{2}}}} \\ 
        &= -\bp{1 - \frac{s}{t}}\max\rp{1, \abs*{\frac{R^{2}}{Dt^{2}} - 1}}
    \end{align}
    Notice that this is \(\geq -1\) if and only if \(\bp{1 - \frac{s}{t}}\cdot\bp{\frac{R^{2}}{Dt^{2}} - 1} \geq 1\), i.e., \(0 < t < R/\sqrt{2D}\) and \(0 \leq s \leq t\cdot\frac{R^{2}/D - 2t^{2}}{R^{2}/D - t^{2}}\), as granted by the assumptions.
    
    Applying this bound, we obtain
    \begin{align}
        &\int_{\R^{D}} p_{t}(\vxi)\bp{1 + \frac{\bp{1 - \frac{s}{t}}t^{2}}{D}\Delta \log p_{t}(\vxi)}^{D}\odif{\vxi} \\ 
        &\leq \int_{\R^{D}}p_{t}(\vxi)\bp{1 + M(s, t, D)\Delta \log p_{t}(\vxi)}\odif{\vxi} \\
        &= 1 + M(s, t, D)\int_{\R^{D}}p_{t}(\vxi)\Delta \log p_{t}(\vxi)\odif{\vxi} \\
        &= 1 - M(s, t, D)\int_{\R^{D}}\ip{\nabla p_{t}(\vxi)}{\nabla\log p_{t}(\vxi)}\odif{\vxi} \\
        &= 1 - M(s, t, D)\int_{\R^{D}}\frac{\norm{\nabla p_{t}(\vxi)}_{2}^{2}}{p_{t}(\vxi)}\odif{\vxi},
    \end{align}
    where the last few lines are the same as in the proof of \Cref{thm:diffusion_entropy_increases}. Combining this result with our previous estimate,
    \begin{equation}
        h(\bar{\vx}(\vx_{t})) - h(\vx_{t}) \leq - M(s, t, D)\int_{\R^{D}}\frac{\norm{\nabla p_{t}(\vxi)}_{2}^{2}}{p_{t}(\vxi)}\odif{\vxi} < 0
    \end{equation}
    where the inequality is strict by the same argument as in \Cref{thm:diffusion_entropy_increases}.
\end{proof}

Notice that the bounds for \(s\) and \(t\) depend on the radius \(R\) of the data distribution, and are not so general as the bounds in \Cref{thm:diffusion_entropy_increases}. The result is actually ``as general as needed'' in the following sense. Note that if \(\vx\) has a twice continuously differentiable density supported on the ball of radius \(R\) centered at \(\vzero\), then it does for \(2R\), and \(3R\), and so on, i.e., for any ball of radius \(R^{\prime} > R\). Thus one strategy to get the appropriate denoising guarantee is: fix a data dimension \(D\) and discretization schedule, and then set (in the analysis) the data radius \(R\) to be very large such that each denoising step satisfies the requirements for entropy decrease given in \Cref{thm:conditioning_reduces_entropy}. Then each step of the denoising process will indeed reduce the entropy, as desired.

 
\subsection{Technical Lemmas and Intermediate Results}\label{sub:app_diffusion_intermediate_results}

In this subsection we present technical results which power our main two conceptual theorems. Our presentation will be more or less standard for mathematics; we will start with the higher-level results first, and gradually move back to the more incremental results. The higher-level results will use the incremental results, and in this way we have an easy-to-read dependency ordering of the results: no result depends on those before it. Results which do not depend on each other are generally ordered by the place they appear in the above pair of proofs. 


\subsubsection{Finitneness of the Differential Entropy}

We first show that the entropy exists along the stochastic process and is finite.

\begin{lemma}\label{lem:diffusion_entropy_exists}
    Let \(\vx\) be any random variable, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. 
    \begin{enumerate}
        \item For \(t > 0\), the differential entropy \(h(\vx_{t})\) exists and is \(> -\infty\).
        \item If in addition \Cref{assumption:entropy_x_compact_support} holds for \(\vx\), then \(h(\vx) < \infty\) and \(h(\vx_{t})\ < \infty\).
    \end{enumerate}
\end{lemma}
\begin{proof}
    To prove \Cref{lem:diffusion_entropy_exists}.1, we use a classic yet tedious analysis argument. Since \(\vx_{t}\) has a density, we can write 
    \begin{equation}
        h(\vx_{t}) = -\int_{\R^{D}}p_{t}(\vxi)\log p_{t}(\vxi) \odif{\vxi}.
    \end{equation}
    Accordingly, let \(g \colon \R^{D} \to \R\) be defined as 
    \begin{equation}
        g(\vxi) := -p_{t}(\vxi)\log p_{t}(\vxi) \implies h(\vx_{t}) = \int_{\R^{D}}g(\vxi)\odif{\vxi}.
    \end{equation}
    As usual to bound the value of an integral in analysis, define 
    \begin{equation}
        g_{+}(\vxi) := \max(g(\vxi), 0), \quad g_{-}(\vxi) := \max(-g(\vxi), 0) \quad \implies \quad g = g_{+} - g_{-}\quad \text{and} \quad g_{+}, g_{-} \geq 0.
    \end{equation}
    Then 
    \begin{equation}
        h(\vx_{t}) = \int_{\R^{D}}g_{+}(\vxi)\odif{\vxi} - \int_{\R^{D}}g_{-}(\vxi)\odif{\vxi},
    \end{equation}
    and both integrals are guaranteed to be non-negative since their integrands are. 
    
    In order to show that \(h(\vx_{t})\) is well-defined, we need to show that \(\int_{\R^{D}}g_{+}(\vxi)\odif{\vxi} < \infty\) or \(\int_{\R^{D}}g_{-}(\vxi) \odif{\vxi} < \infty\). To show that \(h(\vx_{t}) > -\infty\), it merely suffices to show that \(\int_{\R^{D}}g_{-}(\vxi)\odif{\vxi} < \infty\). To bound the integral of \(g_{-}\) we need to understand the quantity \(g_{-}\), namely, we want to characterize when \(g\) is negative.
    \begin{equation}
        g(\vxi) \leq 0 \iff p_{t}(\vxi)\log p_{t}(\vxi) \geq 0 \iff \log p_{t}(\vxi) \geq 0 \iff p_{t}(\vxi) \geq 1.
    \end{equation}
    Thus, it holds that 
    \begin{equation}
        g_{-}(\vxi) = \indvar(p_{t}(\vxi) \geq 1)\cdot (-g(\vxi)) = \indvar(p_{t}(\vxi) \geq 1)p_{t}(\vxi)\log p_{t}(\vxi).
    \end{equation}
    In order to bound the integral of \(g_{-}(\vxi)\), we need to show that \(p_{t}\) is ``not too concentrated,'' namely that \(p_{t}\) is not too large. To prove this, in this case we are lucky enough to be able to bound the function \(g_{-}(\vxi)\) itself. Namely, notice that 
    \begin{equation}
        \max_{\vxi \in \R^{D}}\phi_{t}(\vxi - \vx) = \phi_{t}(\vzero) = \frac{1}{(2\pi)^{D/2}t^{D}} =: C_{t}.
    \end{equation}
    which blows up as \(t \to 0\) but is finite for all finite \(t\). Therefore 
    \begin{equation}
        p_{t}(\vxi) = \Ex \phi_{t}(\vxi - \vx) \leq \Ex C_{t} = C_{t}.
    \end{equation}
    Now there are two cases.
    \begin{itemize}
        \item If \(C_{t} < 1\), then \(p_{t}(\vxi) < 1\), so the indicator is never \(1\), hence \(g_{-} = 0\) identically and its integral is also \(0\).
        \item If \(C_{t} \geq 1\), then \(\log C_{t} \geq 0\), so since the logarithm is monotonically increasing,
        \begin{align}
            \int_{\R^{D}}g_{-}(\vxi)\odif{\vxi}
            &= \int_{\R^{D}}\indvar(p_{t}(\vxi) \geq 1)p_{t}(\vxi)\log p_{t}(\vxi)\odif{\vxi}  \\ 
            &= \Ex[\indvar(p_{t}(\vx_{t}) \geq 1)\log p_{t}(\vx_{t})]  \\ 
            &\leq \Ex[\indvar(p_{t}(\vx_{t}) \geq 1) \log C_{t}] \\ 
            &= \Pr[p_{t}(\vx_{t}) \geq 1]\log C_{t}.
        \end{align}
    \end{itemize}
    Hence we have \(\int_{\R^{D}}g_{-}(\vxi)\odif{\vxi} < \infty\), so the differential entropy \(h(\vx_{t})\) exists and is \(> -\infty\).

    To prove \Cref{lem:diffusion_entropy_exists}.2, suppose that \Cref{assumption:entropy_x_compact_support} holds. We want to show that \(h(\vx) < \infty\) and \(h(\vx_{t}) < \infty\). The mechanism for doing this is the same, and involves the maximum entropy result \Cref{thmx:max_entropy}. Namely, since \(\vx\) is absolutely bounded, it has a finite covariance which we will denote \(\vSigma\). Then the covariance of \(\vx_{t}\) is \(\vSigma + t^{2}\vI\). Thus the entropy of \(\vx\) and \(\vx_{t}\) can be upper bounded by the entropy of normal distributions with the respective covariances, i.e., \(\log[(2\pi e)^{D}\det(\vSigma)]\) or \(\log[(2\pi e)^{D}\det(\vSigma + t^{2}\vI)]\), and both are \(< \infty\).
\end{proof}

\subsubsection{Integration by Parts in De Brujin Identity}

Finally, we fill in the integration-by-parts argument alluded to in the proofs of \Cref{thm:diffusion_entropy_increases,thm:conditioning_reduces_entropy}. The argument is conceptually pretty simple but requires some technical estimates to show that the boundary term in the integration-by-parts vanishes.

\begin{lemma}\label{lem:diffusion_ibp}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. For \(t \geq 0\), let \(p_{t}\) be the density of \(\vx_{t}\). Then for a constant \(c \in \R\) it holds 
    \begin{equation}
        \int_{\R^{D}}\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)]\odif{\vxi} = -\int_{\R^{D}}\ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}\odif{\vxi}.
    \end{equation}
\end{lemma}
\begin{proof}
    The basic idea of this proof is in two steps:
    \begin{itemize}
        \item First, apply Green's theorem to do integration by parts over a compact set;
        \item Second, send the radius of this compact set to \(+\infty\), to get integrals over all of \(\R^{D}\).
    \end{itemize}
    Green's theorem says that for any compact set \(\cK \subseteq \R^{D}\), twice continuously differentiable \(\plainphi \colon \R^{D} \to \R\), and continuously differentiable \(\psi \colon \R^{D} \to \R\),
    \begin{equation}
        \int_{\cK}\bc{\psi(\vxi) \Delta \plainphi(\vxi) + \ip{\nabla \psi(\vxi)}{\nabla \plainphi(\vxi)}}\odif{\vxi} = \int_{\partial \cK}\psi(\vxi)\ip{\nabla \plainphi(\vxi)}{\vn(\vxi)}\odif{\sigma(\vxi)}
    \end{equation}
    where \(\odif{\sigma(\vxi)}\) denotes an integral over the ``surface measure'', i.e., the inherited measure on \(\partial \cK\), namely the boundary of \(\cK\), and accordingly \(\vxi\) takes values on this surface and \(\vn(\vxi)\) is the unit normal vector to \(\cK\) at the surface point \(\vxi\). Now, taking \(\plainphi(\vxi) := p_{t}(\vxi)\) and \(\psi(\vxi) := c + \log p_{t}(\vxi)\), over a ball \(B_{r}(\vzero)\) of radius \(r > 0\) centered at \(\vzero\) (so that \(\partial B_{r}(\vzero)\) is the sphere of radius \(r\) centered at \(\vzero\) and \(\vn(\vxi) = \vxi/\norm{\vxi}_{2} = \vxi/r\)):
    \begin{align}
        &\int_{B_{r}(\vzero)}\bc{\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)] + \ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}}\odif{\vxi} \\
        &= \int_{\partial B_{r}(\vzero)}[c + \log p_{t}(\vxi)]\ip*{\nabla p_{t}(\vxi)}{\frac{\vxi}{r}}\odif{\sigma(\vxi)} \\
        &= \frac{1}{r}\int_{\partial B_{r}(\vzero)}[c + \log p_{t}(\vxi)]\ip*{\nabla p_{t}(\vxi)}{\vxi}\odif{\sigma(\vxi)}.
    \end{align}
    Sending \(r \to \infty\), it holds that 
    \begin{align}
        &\int_{\R^{D}}\bc{\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)] + \ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}}\odif{\vxi} \label{eq:app_diffusion_r_infinity_limit} \\
        &= \lim_{r \to \infty}\int_{B_{r}(\vzero)}\bc{\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)] + \ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}}\odif{\vxi} \\
        &= \lim_{r \to \infty}\int_{\partial B_{r}(\vzero)}\bc{\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)] + \ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}}\odif{\vxi} \\ 
        &= \lim_{r \to \infty}\frac{1}{r}\int_{\partial B_{r}(\vzero)}[c + \log p_{t}(\vxi)]\ip*{\nabla p_{t}(\vxi)}{\vxi}\odif{\sigma(\vxi)},
    \end{align}
    where the first inequality follows by dominated convergence on the integrand. It remains to compute the last limit. For this, we take asymptotic expansions of each term. The main device is as follows: for \(\vxi \in \partial B_{r}(\vzero)\), we have \(\norm{\vxi}_{2} = r\), so
    \begin{align}
        p_{t}(\vxi)
        &= \Ex[\phi_{t}(\vxi - \vx)] \\ 
        &= \Ex\rs{\underbrace{\frac{1}{(2\pi)^{D/2}t^{D}}}_{:= C_{t}}e^{-\|\vxi - \vx\|_{2}^{2}/(2t^{2})}} \\
        &= C_{t}\Ex\rs{e^{-(\norm{\vxi}_{2}^{2} - 2\ip{\vxi}{\vx} + \norm{\vx}_{2}^{2})/(2t^{2})}} \\ 
        &= C_{t}\Ex\rs{e^{-(r^{2} - 2\ip{\vxi}{\vx} + \norm{\vx}_{2}^{2})/(2t^{2})}} \\ 
        &= C_{t}e^{-r^{2}/(2t^{2})}\Ex[e^{(2\ip{\vxi}{\vx} - \norm{\vx}_{2}^{2})/(2t^{2})}]. 
    \end{align}
    Note that because \(\norm{\vxi}_{2} = r\), we have by Cauchy-Schwarz that
    \begin{equation}
        -2r\norm{\vx}_{2} - \norm{\vx}_{2}^{2} \leq 2\ip{\vxi}{\vx} - \norm{\vx}_{2}^{2} \leq 2r\norm{\vx}_{2} - \norm{\vx}_{2}^{2}.
    \end{equation}
    Recall that by \Cref{assumption:entropy_x_compact_support}, \(\vx\) is supported on a compact set \(\cS\) of radius \(R\). Thus 
    \begin{equation}
        -2R(r + R) \leq 2\ip{\vxi}{\vx} - \norm{\vx}_{2}^{2} \leq 2Rr.
    \end{equation}
    In other words, it holds
    \begin{equation}
        C_{t}e^{-[r^{2} + 2R(r + R)]/(2t^{2})} \leq p_{t}(\vxi) \leq C_{t}e^{[-r^{2} + 2Rr]/(2t^{2})}.
    \end{equation}
    Now to compute the gradient, we can use \Cref{prop:p_t_derivatives} and linearity of expectation to compute
    \begin{align}
        \ip{\nabla p_{t}(\vxi)}{\vxi}
        &= \ip*{-\frac{1}{t^{2}}\Ex\rs{\bp{\vxi - \vx}\phi_{t}(\vxi - \vx)}}{\vxi} \\
        &= -\frac{1}{t^{2}}\Ex\rs{\ip{\vxi - \vx}{\vxi}\phi_{t}(\vxi - \vx)} \\
        &= -\frac{1}{t^{2}}\Ex\rs{\bp{\norm{\vxi}_{2}^{2} - \ip{\vxi}{\vx}}\phi_{t}(\vxi - \vx)} \\
        &= -\frac{1}{t^{2}}\Ex\rs{\bp{r^{2} - \ip{\vxi}{\vx}}\phi_{t}(\vxi - \vx)} \\
        &= \frac{1}{t^{2}}\Ex\rs{\bp{\ip{\vxi}{\vx} - r^{2}}\phi_{t}(\vxi - \vx)}.
    \end{align}
    Using Cauchy-Schwarz and the representation \(p_{t}(\vxi) := \Ex[\phi_{t}(\vxi - \vx)]\) again, it holds
    \begin{align}
        &\frac{1}{t^{2}}\Ex\rs{\bp{-Rr - r^{2}}\phi_{t}(\vxi - \vx)} \leq \ip{\nabla p_{t}(\vxi)}{\vxi} \leq \frac{1}{t^{2}}\Ex\rs{\bp{Rr - r^{2}}\phi_{t}(\vxi - \vx)} \\
        &\frac{1}{t^{2}}\bp{-Rr - r^{2}}\Ex\rs{\phi_{t}(\vxi - \vx)} \leq \ip{\nabla p_{t}(\vxi)}{\vxi} \leq \frac{1}{t^{2}}\bp{Rr - r^{2}}\Ex\rs{\phi_{t}(\vxi - \vx)} \\
        &-\frac{r(R + r)}{t^{2}}p_{t}(\vxi) \leq \ip{\nabla p_{t}(\vxi)}{\vxi} \leq -\frac{r(r - R)}{t^{2}}p_{t}(\vxi).
    \end{align}
    For \(r > R > 0\) (as is suitable, because we are going to take the limit \(r \to \infty\) while \(R\) is fixed), both sides are negative. This makes sense: most of the probability mass is contained within the ball of radius \(R\) and thus the score points inwards, having a negative inner product with the outward-pointing vector \(\vxi\). Thus using the appropriate bounds for \(p_{t}(\vxi)\),
    \begin{equation}
        -\frac{r(R + r)}{t^{2}}\cdot C_{t}e^{[-r^{2} + 2Rr]/(2t^{2})} \leq \ip{\nabla p_{t}(\vxi)}{\vxi} \leq -\frac{r(r - R)}{t^{2}}\cdot C_{t}e^{-[r^{2} + 2R(r + R)]/(2t^{2})}.
    \end{equation}
    Then, noting that \(C_{t} = \mathrm{poly}(t^{-1})\), we can compute 
    \begin{equation}
        [c + \log p_{t}(\vxi)]\ip{\nabla p_{t}(\vxi)}{\vxi} = \mathrm{poly}(r, R, t^{-1}, c)e^{-\Theta_{r}(r^{2})}
    \end{equation}
    So one can see that, letting the surface area of \(\partial B_{r}(\vzero)\) be \(\omega_{D} r^{D - 1}\) where \(\omega_{D}\) is a function of\(D\), it holds
    \begin{equation}
        \frac{1}{r}\int_{\partial B_{r}(\vzero)}[c + \log p_{t}(\vxi)]\ip{\nabla p_{t}(\vxi)}{\vxi}\odif{\vxi} = \mathrm{poly}(r, R, t^{-1}, c)e^{-\Theta_{r}(r^{2})}
    \end{equation}
    and therefore the exponentially decaying tails mean
    \begin{equation}
        \lim_{r \to \infty}\frac{1}{r}\int_{\partial B_{r}(\vzero)}[c + \log p_{t}(\vxi)]\ip{\nabla p_{t}(\vxi)}{\vxi}\odif{\vxi} = 0.
    \end{equation}
    Finally, plugging into \eqref{eq:app_diffusion_r_infinity_limit}, we have
    \begin{align}
        &\int_{\R^{D}}\bc{\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)] + \ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}}\odif{\vxi} = 0 \\
        \implies 
        &\int_{\R^{D}}\Delta p_{t}(\vxi)[c + \log p_{t}(\vxi)]\odif{\vxi} = -\int_{\R^{D}}\ip{\nabla \log p_{t}(\vxi)}{\nabla p_{t}(\vxi)}\odif{\vxi}
    \end{align}
    as claimed.
\end{proof}

\subsubsection{Local Invertibility of the Denoiser \(\bar{\vx}\)}

Here we provide some results used in the proof of \Cref{thm:conditioning_reduces_entropy} which are appropriate generalizations of corresponding results in \cite{Gribonval2011-pf}.

\begin{lemma}[Generalization of \cite{Gribonval2011-pf}, Lemma A.1]\label{lem:gribonval_A1}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. Let \(s, t \in [0, T]\) be such that \(0 \leq s < t \leq T\), and let \(\bar{\vx}(\vxi) := \Ex[\vx_{s} \mid \vx_{t} = \vxi]\). The Jacobian \(\bar{\vx}^{\prime}(\vxi)\) is symmetric positive definite.
\end{lemma}
\begin{proof}
    We have 
    \begin{equation}
        \bar{\vx}^{\prime}(\vxi) = \vI + \bp{1 - \frac{s}{t}}t^{2}\nabla^{2}\log p_{t}(\vxi).
    \end{equation}
    Here we expand 
    \begin{equation}
        \nabla^{2}\log p_{t}(\vxi) = \frac{p_{t}(\vxi)\nabla^{2}p_{t}(\vxi) - (\nabla p_{t}(\vxi))(\nabla p_{t}(\vxi))^{\top}}{p_{t}(\vxi)^{2}}.
    \end{equation}
    So we need to ensure that 
    \begin{align}
        \bar{\vx}^{\prime}(\vxi)
        &= \vI + \bp{1 - \frac{s}{t}}t^{2}\frac{p_{t}(\vxi)\nabla^{2}p_{t}(\vxi) - (\nabla p_{t}(\vxi))(\nabla p_{t}(\vxi))^{\top}}{p_{t}(\vxi)^{2}} \\
        &= \frac{p_{t}(\vxi)^{2}\vI + \bp{1 - \frac{s}{t}}t^{2}\bs{p_{t}(\vxi)\nabla^{2}p_{t}(\vxi) - (\nabla p_{t}(\vxi))(\nabla p_{t}(\vxi))^{\top}}}{p_{t}(\vxi)^{2}}
    \end{align}
    is symmetric positive semidefinite. Indeed it is obviously symmetric (by Clairaut's theorem). To show its positive semidefiniteness, we plug in the expectation representation of \(p_{t}\) given by \eqref{eq:p_t_representation} (and \(\nabla p_{t}\), \(\Delta p_{t}\) by \Cref{prop:p_t_derivatives}) to obtain (where \(\vx\) is as defined and \(\vy\) is i.i.d.~as \(\vx\)),
    \begin{align}
        &\vv^{\top}[\bar{\vx}^{\prime}(\vxi)]\vv \\
        &= p_{t}(\vxi)^{-2}\vv^{\top}\Bigg\{p_{t}(\vxi)^{2}\vI + \bp{1 - \frac{s}{t}}t^{2}\Ex[\phi_{t}(\vxi - \vx)]\Ex\rs{\phi_{t}(\vxi - \vx)\cdot\frac{(\vxi - \vx)(\vxi - \vx)^{\top} - t^{2}\vI}{t^{4}}} \\
        & \qquad \qquad \qquad -\bp{1 - \frac{s}{t}}t^{2}\Ex\rs{-\phi_{t}(\vxi - \vx)\cdot\frac{\vxi - \vx}{t^{2}}}\Ex\rs{-\phi_{t}(\vxi - \vx)\cdot\frac{\vxi - \vx}{t^{2}}}^{\top}\Bigg\}\vv \\
        &= p_{t}(\vxi)^{-2}\vv^{\top}\Bigg\{\Ex[\phi_{t}(\vxi - \vx)\phi_{t}(\vxi - \vy)\vI] \\
        & \qquad \qquad \qquad + \bp{1 - \frac{s}{t}}t^{2}\Ex\rs{\phi_{t}(\vxi - \vx)\phi_{t}(\vxi - \vy)\cdot\frac{(\vxi - \vy)(\vxi - \vy)^{\top} - t^{2}\vI}{t^{4}}} \\
        & \qquad \qquad \qquad -\bp{1 - \frac{s}{t}}t^{2}\Ex\rs{\phi_{t}(\vxi - \vx)\phi_{t}(\vxi - \vy)\cdot\frac{(\vxi - \vx)(\vxi - \vy)^{\top}}{t^{4}}}\Bigg\} \\ 
        &= \frac{1 - s/t}{p_{t}(\vxi)^{2}}\vv^{\top}\Ex\mathopen{}\Bigg[\phi_{t}(\vxi - \vx)\phi_{t}(\vxi - \vy)\bc{\frac{1}{1 - s/t}\vI + \frac{(\vxi - \vy)(\vxi - \vy)^{\top}}{t^{2}} - \vI - \frac{(\vxi - \vx)(\vxi - \vy)^{\top}}{t^{2}}}\Bigg]\vv \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\vv^{\top}\Ex\rs{\frac{s}{t - s}\vI +\frac{(\vxi - \vx)(\vxi - \vx)^{\top}}{2t^{2}} + \frac{(\vxi - \vy)(\vxi - \vy)^{\top}}{2t^{2}} - \frac{(\vxi - \vx)(\vxi - \vy)^{\top}}{t^{2}}}\vv \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\vv^{\top}\Ex\rs{\frac{s}{t - s}\vI +\frac{1}{2t^{2}}\bp{(\vxi - \vx)(\vxi - \vx)^{\top} + (\vxi - \vy)(\vxi - \vy)^{\top} - 2(\vxi - \vx)(\vxi - \vy)^{\top}}}\vv \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\Ex\rs{\frac{s}{t - s}\norm{\vv}_{2}^{2} +\frac{1}{2t^{2}}\bp{[(\vxi - \vx)^{\top}\vv]^{2} + [(\vxi - \vy)^{\top}\vv]^{2} - 2[(\vxi - \vx)^{\top}\vv][(\vxi - \vy)^{\top}\vv]}} \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\Ex\rs{\frac{s}{t - s}\norm{\vv}_{2}^{2} +\frac{1}{2t^{2}}\bp{[(\vxi - \vx)^{\top}\vv]^{2} + [(\vxi - \vy)^{\top}\vv]^{2} - 2[(\vxi - \vx)^{\top}\vv][(\vxi - \vy)^{\top}\vv]}} \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\Ex\rs{\frac{s}{t - s}\norm{\vv}_{2}^{2} +\frac{1}{2t^{2}}\bp{[(\vxi - \vx)^{\top}\vv] - [(\vxi - \vy)^{\top}\vv]}^{2}} \\
        &= \frac{t - s}{tp_{t}(\vxi)^{2}}\Ex\rs{\frac{s}{t - s}\norm{\vv}_{2}^{2} +\frac{1}{2t^{2}}[(\vy - \vx)^{\top}\vv]^{2}} \\
        &= \frac{s}{tp_{t}(\vxi)^{2}}\norm{\vv}_{2}^{2} + \frac{t - s}{2t^{3}p_{t}(\vxi)}\Ex[\{(\vy - \vx)^{\top}\vv\}^{2}]
    \end{align}
    Since \(\vx\) and \(\vy\) are i.i.d., the whole integral (i.e., the original quadratic form) is \(0\) if and only if \(s = 0\) and \(\vx\) has support entirely contained in an affine subspace which is orthogonal to \(\vv\). But this is ruled out by assumption (i.e., that \(\vx\) has a density on \(\R^{D}\)), so the Jacobian \(\bar{\vx}^{\prime}(\vxi)\) is symmetric positive definite.
\end{proof}

\begin{lemma}[Generalization of \cite{Gribonval2011-pf} Corollary A.2, Part 1]\label{lem:gribonval_A2}
    Let \(f \colon \R^{D} \to \R^{D}\) be any differentiable function whose Jacobian \(f^{\prime}(\vx)\) is symmetric positive definite. Then \(f\) is injective, and hence invertible as a function \(\R^{D} \to \Range(f)\) where \(\Range(f)\) is the range of \(f\).
\end{lemma}
\begin{proof}
    Suppose that \(f\) were not injective, i.e., there exists \(\vx, \vx^{\prime}\) such that \(f(\vx) = f(\vx^{\prime})\) while \(\vx \neq \vx^{\prime}\). Define \(\vv := (\vx^{\prime} - \vx)/\norm{\vx^{\prime} - \vx}_{2}\). Define the function \(g \colon \R \to \R\) as \(g(t) := \vv^{\top}f(\vx + t\vv)\). Then \(g(0) = \vv^{\top}f(\vx) = \vv^{\top}f(\vx^{\prime}) = g(\norm{\vx^{\prime} - \vx}_{2})\). Since \(f\) is differentiable, \(g\) is differentiable, so the derivative  \(g^{\prime}\) must vanish for some \(t^{\ast} \in (0, \norm{\vx^{\prime} - \vx}_{2})\) by the mean value theorem. However,
    \begin{equation}
        g^{\prime}(t^{\ast}) := \vv^{\top}\bs{f^{\prime}(\vx + t^{\ast}\vv)}\vv > 0
    \end{equation}
    since the Jacobian is positive definite. Thus we arrive at a contradiction, as claimed.
\end{proof}

Combining the above two results, we obtain the following crucial result.

\begin{corollary}[Generalization of \cite{Gribonval2011-pf} Corollary A.2, Part 2]\label{cor:gribonval_A2}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. Let \(s, t \in [0, T]\) be such that \(0 \leq s < t \leq T\), and let \(\bar{\vx}(\vxi) := \Ex[\vx_{s} \mid \vx_{t} = \vxi]\). Then \(\bar{\vx}\) is injective, and therefore invertible onto its range.
\end{corollary}
\begin{proof}
    The only thing left to show is that \(\bar{\vx}\) is differentiable,  but this is immediate from Tweedie's formula (\Cref{thm:tweedie}) which shows that \(\bar{\vx}\) is differentiable if and only if \(\nabla \log p_{t}\) is differentiable, and this is provided by \Cref{eq:p_t_representation}.
\end{proof}

\subsubsection{Controlling the Laplacian \(\Delta \log p_{t}\)}

Finally, we develop a technical estimate which is required for the proof of \Cref{thm:conditioning_reduces_entropy} and actually motivates the assumption for the viable \(t\).

\begin{lemma}\label{lem:app_diffusion_laplacian_control}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. Let \(p_{t}\) be the density of \(\vx_{t}\). Then, for \(t > 0\) it holds 
    \begin{equation}
        \sup_{\vxi \in \R^{D}}\abs{\Delta \log p_{t}(\vxi)} \leq \max\rp{\frac{D}{t^{2}}, \abs*{\frac{R}{t^{4}} - \frac{D}{t^{2}}}}.
    \end{equation}
\end{lemma}
\begin{proof}
    By chain rule, a simple exercise computes 
    \begin{equation}
        \Delta \log p_{t}(\vxi) = \frac{\Delta p_{t}(\vxi)}{p_{t}(\vxi)} - \frac{\norm{\nabla p_{t}(\vxi)}_{2}^{2}}{p_{t}(\vxi)^{2}}.
    \end{equation}
    Using \Cref{prop:p_t_derivatives} to write the terms in \(\Delta p_{t}(\vxi)\), we obtain
    \begin{align}
        \frac{\Delta p_{t}(\vxi)}{p_{t}(\vxi)}
        &= \frac{\Ex\rs{\frac{\norm{\vxi - \vx}_{2}^{2} - Dt^{2}}{t^{4}} \cdot \phi_{t}(\vxi - \vx)}}{\Ex[\phi_{t}(\vxi - \vx)]} \\
        &= \frac{\int_{\R^{D}}\bc{\frac{\norm{\vxi - \vu}_{2}^{2} - Dt^{2}}{t^{4}}}\phi_{t}(\vxi - \vu)p(\vu)\odif{\vu}}{\int_{\R^{D}}\phi_{t}(\vxi - \vu)p(\vu)\odif{\vu}}.
    \end{align}
    This looks like a Bayesian marginalization, so let us define the appropriate normalized density
    \begin{equation}
        q_{\vxi}(\vu) = \frac{\phi_{t}(\vxi - \vu)p(\vu)}{\int_{\R^{D}}\phi_{t}(\vxi - \vv)p(\vv)\odif{\vv}} = \frac{\phi_{t}(\vxi - \vu)p(\vu)}{\Ex[\phi_{t}(\vxi - \vx)]} = \frac{\phi_{t}(\vxi - \vu)p(\vu)}{p_{t}(\vxi)}
    \end{equation}
    Then, defining \(\vy_{\vxi} \sim q_{\vxi}\), we can write 
    \begin{equation}
        \frac{\Delta p_{t}(\vxi)}{p_{t}(\vxi)} = \int_{\R^{D}}\bc{\frac{\norm{\vxi - \vu}_{2}^{2} - Dt^{2}}{t^{4}}}q_{\vxi}(\vu)\odif{\vu} = \frac{1}{t^{4}}\Ex[\norm{\vxi - \vy_{\vxi}}_{2}^{2}] - \frac{D}{t^{2}}.
    \end{equation}
    Similarly, writing out the second term (non-squared) we obtain
    \begin{equation}
        \frac{\nabla p_{t}(\vxi)}{p_{t}(\vxi)} = -\frac{\vxi - \Ex[\vy_{\vxi}]}{t^{2}}.
    \end{equation}
    Letting \(\vz_{\vxi} := \vy_{\vxi} - \vxi\), it holds 
    \begin{equation}
        \frac{\Delta p_{t}(\vxi)}{p_{t}(\vxi)} = \frac{\Ex[\norm{\vz_{\vxi}}_{2}^{2}]}{t^{4}} - \frac{D}{t^{2}}, \qquad \frac{\nabla p_{t}(\vxi)}{p_{t}(\vxi)} = \frac{\Ex[\vz_{\vxi}]}{t^{2}}.
    \end{equation}
    Thus writing \(\Delta \log p_{t}\) out fully, we have 
    \begin{align}
        \Delta \log p_{t}(\vxi)
        &= \frac{\Ex[\norm{\vz_{\vxi}}_{2}^{2}]}{t^{4}} - \frac{D}{t^{2}} - \frac{\norm{\Ex[\vz_{\vxi}]}_{2}^{2}}{t^{4}} \\
        &= \frac{\Ex[\norm{\vz_{\vxi}}_{2}^{2}] - \norm{\Ex[\vz_{\vxi}]}_{2}^{2}}{t^{4}} - \frac{D}{t^{2}} \\
        &= \frac{\tr(\Cov(\vz_{\vxi}))}{t^{4}} - \frac{D}{t^{2}} \\
        &= \frac{\tr(\Cov(\vy_{\vxi}))}{t^{4}} - \frac{D}{t^{2}}.
    \end{align}
    A trivial lower bound on this trace is \(0\), since covariance matrices are positive semidefinite. To find an upper bound, note that \(\vy_{\vxi}\) takes values only in the support of \(\vx\) (since \(p\) is a factor of the density \(q_{\vxi}\) of \(\vy_{\vxi}\)), which by \Cref{assumption:entropy_x_compact_support} is a compact set \(\cS\) with radius \(R := \sup_{\vxi \in \R^{D}}\norm{\vxi}_{2}\). So 
    \begin{equation}
        \tr(\Cov(\vy_{\vxi})) = \Ex[\norm{\vy_{\vxi}}_{2}^{2}] - \norm{\Ex[\vy_{\vxi}]}_{2}^{2} \leq \Ex[\norm{\vy_{\vxi}}_{2}^{2}] \leq R^{2}.
    \end{equation}
    Therefore 
    \begin{equation}
        -\frac{D}{t^{2}} \leq \Delta \log p_{t}(\vxi) \leq \frac{R^{2}}{t^{4}} - \frac{D}{t^{2}},
    \end{equation}
    which shows the claim.
\end{proof}

\subsubsection{Derivative Computations}

Here we calculate some useful derivatives which will be reused throughout the appendix.

\begin{proposition}\label{prop:p_t_derivatives}
    Let \(\vx\) be any random variable such that \Cref{assumption:entropy_x_compact_support,assumption:entropy_x_density} hold, and let \((\vx_{t})_{t \in [0, T]}\) be the stochastic process \eqref{eq:app_additive_gaussian_noise_model}. For \(t \geq 0\), let \(p_{t}\) be the density of \(\vx_{t}\). Then
    \begin{align}
        \pdv{p_{t}}{t}(\vxi)
        &= \Ex\rs{\phi_{t}(\vxi - \vx)\cdot\frac{\norm{\vxi - \vx}_{2}^{2} - Dt^{2}}{t^{3}}} \\
        \nabla p_{t}(\vxi)
        &= -\Ex\rs{\phi_{t}(\vxi - \vx)\cdot\frac{\vxi - \vx}{t^{2}}} \\
        \nabla^{2}p_{t}(\vxi)
        &= \Ex\rs{\phi_{t}(\vxi - \vx)\cdot\frac{(\vxi - \vx)(\vxi - \vx)^{\top} - t^{2}\vI}{t^{4}}} \\ 
        \Delta p_{t}(\vxi)
        &= \Ex\rs{\phi_{t}(\vxi - \vx)\cdot\frac{\norm{\vxi - \vx}_{2}^{2} - Dt^{2}}{t^{4}}}.
    \end{align}
\end{proposition}
\begin{proof} 
    We use the convolution representation of \(p_{t}\), namely \eqref{eq:p_t_representation}. First taking the time derivative, a computation yields that \Cref{prop:dutis} applies,\footnote{We use \(f_{t}(\vxi) = p(\vxi) \phi_{t}(\vxi - \vx)\), noting that it is twice continuously differentiable in \(\vxi\) and (more than) twice continuously differentiable in \(t\). Then to check the local integrability of \(f_{t}\) we compute \(\pdv{f_{t}}{t}(\vxi) = f_{t}(\vxi)\cdot \frac{1}{t^{3}}(\norm{\vxi - \vx}_{2}^{2} - Dt^{2})\), which is is easy to check integrable over \(\vxi\) and \(t \in [t_{\min}, t_{\max}]\) where \(t_{\min} > 0\). (Indeed, \(f_{t}\) has exponentially decaying tails, so the quadratic term in the product is of no issue.)} so we can bring the derivative inside the integral/expectation as:
    \begin{equation}
        \pdv{p_{t}}{t}(\vxi) = \pdv*{\Ex[\phi_{t}(\vxi - \vx)]}{t} = \Ex\rs{\pdv*{\phi_{t}(\vxi - \vx)}{t}} = \pdv{\phi_{t}}{t} * p.
    \end{equation}
    Meanwhile, by properties of convolutions (\Cref{prop:diff_convolution}) and using the fact that \(p\) is compactly supported (\Cref{assumption:entropy_x_compact_support}),
    \begin{equation}
        p_{t} = \phi_{t} * p \implies \nabla p_{t} = \nabla \phi_{t} * p \implies \nabla^{2}p_{t} = \nabla^{2}\phi_{t} * p \implies \Delta p_{t} = \Delta \phi_{t} * p.
    \end{equation}
    The rest of the computation follows from \Cref{prop:normal_derivatives}.
\end{proof}


\begin{proposition}\label{prop:normal_derivatives}
    For \(t > 0\) and \(\vxi \in \R^{D}\) it holds 
    \begin{align}
        \pdv*{\phi_{t}}{t}(\vxi)
        &= \phi_{t}(\vxi) \cdot \frac{\norm{\vxi}_{2}^{2} - Dt^{2}}{t^{3}} \\
        \nabla \phi_{t}(\vxi)
        &= -\phi_{t}(\vxi)\cdot\frac{\vxi}{t^{2}} \\ 
        \nabla^{2} \phi_{t}(\vxi)
        &= \phi_{t}(\vxi)\cdot\frac{\vxi\vxi^{\top} - t^{2}\vI}{t^{4}} \\
        \Delta \phi_{t}(\vxi)
        &= \phi_{t}(\vxi) \cdot \frac{\norm{\vxi}_{2}^{2} - Dt^{2}}{t^{4}}.
    \end{align}
\end{proposition}
\begin{proof}
    Direct computation.
\end{proof}



\subsubsection{Differentiating Under the Integral Sign}

In this appendix, we differentiate under the integral sign many times, and it is important to know when we can do this. There are two kinds of differentiating under the integral sign:
\begin{enumerate}
    \item Differentiating an integral \(\int f_{t}(\vxi)\odif{\vxi}\) with respect to the auxiliary parameter \(t\).
    \item Differentiating a convolution \((f * g)(\vxi) = \int f(\vxi)g(\vxi - \vu)\odif{u}\) with respect to the variable \(\vxi\).
\end{enumerate}

For the first category, we give a concrete result, stated without proof but attributable to \href{https://planetmath.org/differentiationundertheintegralsign}{the linked source}, which derives the following result as a special case of a more general theorem about the interaction of differential operators and tempered distributions, much beyond the scope of the book. A full formal reference can be found in \cite{jones1982theory}.
\begin{proposition}[\cite{jones1982theory}, Section 11.12]\label{prop:dutis}
    Let \(f \colon (0, T) \times \R^{D} \to \R\) be such that:
    \begin{itemize}
        \item \(f\) is a jointly measurable function of \((t, \vxi)\);
        \item For Lebesgue-almost every \(\vxi \in \R^{D}\), the function \(t \mapsto f_{t}(\vxi)\) is absolutely continuous;
        \item \(\pdv{f_{t}}{t}\) is locally integrable, i.e., for every \([t_{\min}, t_{\max}] \subseteq (0, T)\) it holds 
        \begin{equation}
            \int_{t_{\min}}^{t_{\max}}\int_{\R^{D}}\abs*{\pdv{f_{t}}{t}(\vxi)}\odif{\vxi} < \infty.
        \end{equation}
    \end{itemize}
    Then \(t \mapsto \int_{\R^{D}}f_{t}(\vxi)\odif{\vxi}\) is an absolutely continuous function on \((0, T)\), and its derivative is 
    \begin{equation}
        \odv*{\int_{\R^{D}}f_{t}(\vxi)\odif{\vxi}}{t} = \int_{\R^{D}}\pdv*{f_{t}}{t}(\vxi)\odif{\vxi},
    \end{equation}
    defined for almost every \(t \in (0, T)\).
\end{proposition}

For the second category, we give another concrete result, stated without proof but fully formalized in \cite{brezis2011functional}.
\begin{proposition}[\cite{brezis2011functional}, Proposition 4.20]\label{prop:diff_convolution}
    Let \(f\) be \(k\)-times continuously differentiable with compact support, and let \(g\) be locally integrable. Then the convolution \(f * g\) defined by
    \begin{equation}
        (f * g)(\vxi) := \int_{\R^{D}}f(\vu)g(\vxi - \vu)\odif{\vu}
    \end{equation}
    is \(k\)-times continuously differentiable, and its derivative of order \(k\) is 
    \begin{equation}
        \nabla^{k}(f * g) =(\nabla^{k}f) * g. 
    \end{equation}
\end{proposition}
Although not in the book, a simple integration by parts argument shows that if \(g\) is also \(k\)-times differentiable, then we can ``trade off'' the regularity:
\begin{equation}
    \nabla^{k}(f * g) = f * (\nabla^{k} g).
\end{equation}




\end{document}