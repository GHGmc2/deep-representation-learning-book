\documentclass{standalone}
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, decorations.pathreplacing}

\begin{document}
\begin{tikzpicture}[
    node distance=1.5cm,
    thick,
    >=Stealth,
    box/.style={rectangle, draw, minimum width=1.5cm, minimum height=1cm, align=center},
    encoder/.style={trapezium, draw, fill=blue!30, minimum width=3cm, minimum height=0.25cm, align=center, shape border rotate=270},
    neuralnet/.style={rectangle, draw, minimum width=2cm, minimum height=1.5cm, align=center},
    image/.style={rectangle, draw, minimum width=2cm, minimum height=2cm, fill=gray!20},
    embedding/.style={rectangle, draw, fill=blue!20, minimum width=0.3cm, minimum height=3cm}
]

% Training Phase
\node[align=left, font=\huge\bfseries] (train_label) at (-2, 4.7) {Training};

% Text input
\node[align=center, font=\small, text=blue] (text_input) at (-4, 2.5) {"a corgi\\playing a\\flame\\throwing\\trumpet"};

% Text encoder
\node[encoder, right=1cm of text_input] (text_encoder) {text\\encoder};

% Text embedding
\node[embedding, right=1cm of text_encoder] (text_embed) {};

% Neural network (denoising)
\node[neuralnet, right=2cm of text_embed] (neural_net) {
    \begin{tikzpicture}[scale=0.3]
        % Simple neural network representation
        \foreach \i in {1,2,3} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (input\i) at (0, \i-2) {};
        }
        \foreach \i in {1,2,3,4} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (hidden\i) at (1.5, \i-2.5) {};
        }
        \foreach \i in {1,2,3} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (output\i) at (3, \i-2) {};
        }
        
        % Connections
        \foreach \i in {1,2,3} {
            \foreach \j in {1,2,3,4} {
                \draw (input\i) -- (hidden\j);
            }
        }
        \foreach \i in {1,2,3,4} {
            \foreach \j in {1,2,3} {
                \draw (hidden\i) -- (output\j);
            }
        }
    \end{tikzpicture}
    \\Denoising\\Network
};

% Noisy image input (for training)
\node[image, above=0.5cm of neural_net] (noisy_image) {\includegraphics[width=1.8cm]{corgi_noise_0.200.png}};

% Clean image output
\node[image, right=1.5cm of neural_net] (clean_image) {\includegraphics[width=1.8cm]{corgi_noise_0.000.png}};

% Training arrows with labels
\draw[->] (text_input) -- (text_encoder) node[midway,above] {$y$};
    \draw[->] (text_encoder) -- (text_embed) node[midway,above] {};
\draw[->] (text_embed) -- (neural_net) node[midway,above] {$\tau(\bm{Y}^+)$};
\draw[->] (noisy_image) -- (neural_net) node[midway,right] {${\bm{x}}_t$};
\draw[->] (neural_net) -- (clean_image) node[midway,above] {${\bm{x}}_{t-\delta}$};

% Labels for embeddings
\node[rotate=90, font=\tiny] at (0.67, 2.5) {text embedding};

\end{tikzpicture}
\end{document}
