\documentclass{standalone}
\usepackage{tikz}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, decorations.pathreplacing}

\begin{document}
\begin{tikzpicture}[
    node distance=1.5cm,
    thick,
    >=Stealth,
    box/.style={rectangle, draw, minimum width=1.5cm, minimum height=1cm, align=center},
    encoder/.style={trapezium, draw, fill=blue!30, minimum width=3cm, minimum height=0.25cm, align=center, shape border rotate=270},
    neuralnet/.style={rectangle, draw, minimum width=2cm, minimum height=1.5cm, align=center},
    image/.style={rectangle, draw, minimum width=2cm, minimum height=2cm, fill=gray!20},
    embedding/.style={rectangle, draw, fill=blue!20, minimum width=0.3cm, minimum height=3cm}
]

% Inference Phase
\node[align=left, font=\huge\bfseries] (app_label) at (-2, 4.7) {Inference};

% Text input for application
\node[align=center, font=\small, text=blue] (app_text_input) at (-4, 2.5) {"a cat\\sitting on\\a rainbow"};

% Text encoder (same as training)
\node[encoder, right=1cm of app_text_input] (app_text_encoder) {text\\encoder};

% Text embedding
\node[embedding, right=1cm of app_text_encoder] (app_text_embed) {};

% Neural network for generation
\node[neuralnet, right=2cm of app_text_embed] (app_neural_net) {
    \begin{tikzpicture}[scale=0.3]
        % Simple neural network representation
        \foreach \i in {1,2,3} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (input\i) at (0, \i-2) {};
        }
        \foreach \i in {1,2,3,4} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (hidden\i) at (1.5, \i-2.5) {};
        }
        \foreach \i in {1,2,3} {
            \node[circle, draw, fill=white, minimum size=0.3cm] (output\i) at (3, \i-2) {};
        }
        
        % Connections
        \foreach \i in {1,2,3} {
            \foreach \j in {1,2,3,4} {
                \draw (input\i) -- (hidden\j);
            }
        }
        \foreach \i in {1,2,3,4} {
            \foreach \j in {1,2,3} {
                \draw (hidden\i) -- (output\j);
            }
        }
    \end{tikzpicture}
    \\Denoising\\Network\\(Iterative)
};

% Random noise input
\node[image, above=0.5cm of app_neural_net] (noise_input) {\includegraphics[width=1.8cm]{corgi_noise_1.000.png}};

% Generated image output
\node[image, right=1.5cm of app_neural_net] (generated_image) {\includegraphics[width=1.8cm]{./cat_noise_0.000.png}};

% Application arrows with labels
\draw[->] (app_text_input) -- (app_text_encoder) node[midway,above] {$y$};
    \draw[->] (app_text_encoder) -- (app_text_embed) node[midway,above] {};
\draw[->] (app_text_embed) -- (app_neural_net) node[midway,above] {$\tau(\bm{Y}^+)$};
\draw[->] (noise_input) -- (app_neural_net) node[midway,right] {$\hat{\bm{x}}_1$};
\draw[->] (app_neural_net) -- (generated_image) node[midway,above] {$\hat{\bm{x}}_0$};

% Labels for embeddings
\node[rotate=90, font=\tiny] at (0.78, 2.5) {text embedding};

\end{tikzpicture}
\end{document}
